<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Gouvernement BORNE : jeu de correspondances">
<meta name="author" content="Guillaume JANDOT">
<link rel="icon" type="image/png" href="gouvtrouv.png">
<title>Gouvernement BORNE</title>
<style>
.nom {position:absolute; z-index:9; left:10px; font-size:1.1em; }
.ministere { position:absolute; font-size:1.2em; border:1px solid black; border-radius:5px; padding:3px; }
.case {position:absolute; border:1px solid black; width:197px; left:195px; }
#scoreaff { position:fixed; top:5px; right:49px; border:1px solid; width:50px; height:20px; }
#scorebar { background-color:#88FF88; height:20px;}
#score { text-align:center; width:100%; position:absolute; }
#essais { color:white; position:fixed; top:50px; right:49px; border:1px solid; padding:5px; border-radius:8px; }
#version a { font-size:0.8em; color:#777777; position:fixed; bottom:5px; right:9px; text-decoration:none; }
.box { position: fixed; z-index:99; background-color: rgba(0,0,0,0.5); width:100%; height:100%; top:0px; left:0px; }
.modal { margin:9% auto; padding:32px; border:3px solid black; width:50%; background-color:white; }
button { cursor:pointer; }
</style>
<noscript>L'application nécessite l'activation de Javascript.</noscript>
<script type="text/javascript">
 const VERDES = "G. JANDOT - 18/07/2022";
 const VERNUM = "1.004";
 
 var score = 0;
 var essais = 0;
 var mouv = false;
 var offx = 0;
 var offy = 0;
 const H_TXT = 32;
 var elt_depl;
 var tab_idx = [];
 var tab_occup = [];
 
 //1) préparer le tab_ministres en clair ("Ministre", "Ministère",)
 //2) appeler la page avec le paramètre ?c
 //3) récuperer le tab_ministres encodé dans la console
 //4) et le remplacer dans la code de la page pour obfuscation basique
 var tab_ministres = [
	"UmltYSBBYmR1bC1NYWxhaw==", "Q3VsdHVyZQ==",
	"R2FicmllbCBBdHRhbA==", "Q29tcHRlcyBwdWJsaWNz",
	"U29uaWEgQmFja+hz", "Q2l0b3llbm5ldOk=",
	"SmVhbi1Ob+tsIEJhcnJvdA==", "VHJhbnNpdGlvbiBudW3pcmlxdWUgZXQgVOls6WNvbW11bmljYXRpb25z",
	"Q2zpbWVudCBCZWF1bmU=", "VHJhbnNwb3J0cw==",
	"T2xpdmllciBCZWNodA==", "Q29tbWVyY2UgZXh06XJpZXVyLCBBdHRyYWN0aXZpdOkgZXQgRnJhbudhaXMgZGUgbCfpdHJhbmdlcg==",
	"Q2hyaXN0b3BoZSBC6WNodQ==", "VHJhbnNpdGlvbiDpY29sb2dpcXVlIGV0IENvaOlzaW9uIGRlcyB0ZXJyaXRvaXJlcw==",
	"SGVydukgQmVydmlsbGU=", "TWVy",
	"TGF1cmVuY2UgQm9vbmU=", "RXVyb3Bl",
	"yWxpc2FiZXRoIEJvcm5l", "UHJlbWnocmUgbWluaXN0cmU=",
	"RnJhbudvaXMgQnJhdW4=", "U2FudOkgZXQgUHLpdmVudGlvbg==",
	"SmVhbi1GcmFu529pcyBDYXJlbmNv", "T3V0cmUtbWVy",
	"Q2hhcmxvdHRlIENhdWJlbA==", "RW5mYW5jZQ==",
	"Q2Fyb2xpbmUgQ2F5ZXV4", "Q29sbGVjdGl2aXTpcyB0ZXJyaXRvcmlhbGVz",
	"Q2F0aGVyaW5lIENvbG9ubmE=", "RXVyb3BlIGV0IEFmZmFpcmVzIOl0cmFuZ+hyZXM=",
	"SmVhbi1DaHJpc3RvcGhlIENvbWJl", "U29saWRhcml06XMsIEF1dG9ub21pZSBwZXJzb25uZXMgaGFuZGljYXDpZXM=",
	"QulyYW5n6HJlIENvdWlsbGFyZA==", "yWNvbG9naWU=",
	"R+lyYWxkIERhcm1hbmlu", "SW506XJpZXVyIGV0IE91dHJlLW1lcg==",
	"R2VuZXZp6HZlIERhcnJpZXVzc2VjcQ==", "UGVyc29ubmVzIGhhbmRpY2Fw6WVz",
	"yXJpYyBEdXBvbmQtTW9yZXR0aQ==", "SnVzdGljZQ==",
	"T2xpdmllciBEdXNzb3B0", "VHJhdmFpbCwgUGxlaW4gZW1wbG9pIGV0IEluc2VydGlvbg==",
	"U2FyYWggRWwgSGHvcnk=", "SmV1bmVzc2UgZXQgU2VydmljZSBuYXRpb25hbCB1bml2ZXJzZWw=",
	"RG9taW5pcXVlIEZhdXJl", "UnVyYWxpdOk=",
	"TWFyYyBGZXNuZWF1", "QWdyaWN1bHR1cmUgZXQgU291dmVyYWluZXTpIGFsaW1lbnRhaXJl",
	"QWdu6HMgRmlybWluIExlIEJvZG8=", "T3JnYW5pc2F0aW9uIHRlcnJpdG9yaWFsZSBldCBQcm9mZXNzaW9ucyBkZSBzYW506Q==",
	"Q2Fyb2xlIEdyYW5kamVhbg==", "RW5zZWlnbmVtZW50IGV0IEZvcm1hdGlvbiBwcm9mZXNzaW9ubmVscw==",
	"T2xpdmlhIEdy6WdvaXJl", "UGV0aXRlcyBldCBtb3llbm5lcyBlbnRyZXByaXNlcywgQ29tbWVyY2UsIEFydGlzYW5hdCBldCBUb3VyaXNtZQ==",
	"U3RhbmlzbGFzIEd1ZXJpbmk=", "VHJhbnNmb3JtYXRpb24gZXQgRm9uY3Rpb24gcHVibGlxdWVz",
	"T2xpdmllciBLbGVpbg==", "VmlsbGUgZXQgTG9nZW1lbnQ=",
	"QnJ1bm8gTGUgTWFpcmU=", "yWNvbm9taWUsIEZpbmFuY2VzIGV0IFNvdXZlcmFpbmV06SBpbmR1c3RyaWVsbGUgZXQgbnVt6XJpcXVl",
	"U+liYXN0aWVuIExlY29ybnU=", "QXJt6WVz",
	"Um9sYW5kIExlc2N1cmU=", "SW5kdXN0cmll",
	"UGF0cmljaWEgTWlyYWxs6HM=", "QW5jaWVucyBjb21iYXR0YW50cyBldCBN6W1vaXJl",
	"UGFwIE5kaWF5ZQ==", "yWR1Y2F0aW9uIG5hdGlvbmFsZSBldCBKZXVuZXNzZQ==",
	"QW3pbGllIE91ZOlhLUNhc3TpcmE=", "U3BvcnRzIGV0IEpldXggb2x5bXBpcXVlcyBldCBwYXJhbHltcGlxdWVz",
	"QWdu6HMgUGFubmllci1SdW5hY2hlcg==",
	"VHJhbnNpdGlvbiDpbmVyZ+l0aXF1ZQ==",
	"U3lsdmllIFJldGFpbGxlYXU=", "RW5zZWlnbmVtZW50IHN1cOlyaWV1ciBldCBSZWNoZXJjaGU=",
	"RnJhbmNrIFJpZXN0ZXI=", "UmVsYXRpb25zIGF2ZWMgbGUgUGFybGVtZW50",
	"SXNhYmVsbGUgUm9tZQ==", "yWdhbGl06SBlbnRyZSBsZXMgZmVtbWVzIGV0IGxlcyBob21tZXMsIERpdmVyc2l06SBldCDJZ2FsaXTpIGRlcyBjaGFuY2Vz",
	"TWFybOhuZSBTY2hpYXBwYQ==", "yWNvbm9taWUgc29jaWFsZSBldCBzb2xpZGFpcmUgZXQgVmllIGFzc29jaWF0aXZl",
	"T2xpdmllciBW6XJhbg==", "UmVub3V2ZWF1IGTpbW9jcmF0aXF1ZSAocG9ydGUtcGFyb2xlIGR1IEdvdXZlcm5lbWVudCk=",
	"Q2hyeXNvdWxhIFphY2hhcm9wb3Vsb3U=", "ROl2ZWxvcHBlbWVudCwgRnJhbmNvcGhvbmllIGV0IFBhcnRlbmFyaWF0cyBpbnRlcm5hdGlvbmF1eA=="
 ];
 var nb_min = tab_ministres.length/2; //pour éviter quelques calculs
 
 function elt(nom_obj)  { return document.getElementById(nom_obj); }
 function rnd(n)		{ return Math.floor(n*Math.random()); } 

////////////// 
 function maj_score()
 {
	elt("score").innerHTML = score + " / " + nb_min;
	elt("scorebar").style.width = Math.floor(score/tab_ministres.length*200) + "%";
	elt("essais").innerHTML = essais + " essai";
	if (essais>1)
	{
		elt("essais").innerHTML += "s";
	}
	var diff=essais-score;
	if (diff>nb_min)
	{
		diff=nb_min;
	}
	//diff 0=>vert >> jaune >> rouge
	var pct = 200*diff/tab_ministres.length;
	var couleur = "rgb(";
	if (pct<50)
	{
		couleur += Math.round(pct*3.4+34);
		couleur += ", 204";
	}
	else
	{
		couleur += "204, ";
		couleur += Math.round((100-pct)*3.4+34);
	}
	couleur += ", 34)";
	elt("essais").style.backgroundColor = couleur;
 }
 
 function bouge(e)
 {
	offx = e.pageX;
	offy = e.pageY;
	elt_depl.style.left = (offx-9) + "px";
	elt_depl.style.top = (offy-9) + "px";;
 }

 function rangement()
 //retour d'un ministre dans la liste de gauche
 {
	elt_depl.style.left = "10px";
	elt_depl.style.top = (elt_depl.num*H_TXT) + "px";
	elt_depl.style.color = "black";
	elt_depl.style.fontWeight  = "normal";
 }

 function unclic(e)
 {
	if (mouv)
	{ //atterrisage
		document.removeEventListener("mousemove", bouge, false);
		if (e.pageX<200)
		//remis à gauche : rangement
		{
			rangement();
		}
		else
		{
			elt_depl.style.left = "200px";

			var h = elt_depl.style.top.substr(0, elt_depl.style.top.length-2);
			h = Math.floor(h/H_TXT);
			if (h<0)
			{
				h=0;
			}
			if (tab_occup[h])
			//la case est déjà occupée : rangement
			{
				rangement();
			}
			else
			//la case n'est pas déjà occupée
			{
				tab_occup[h] = true;
				essais++;
				if (elt_depl.num==tab_idx[h])
				{
					elt_depl.style.color = "green";
					elt_depl.style.fontWeight = "bold";
					score++;
					if (score==nb_min)
					{
						maj_score();
						fin();
						return;
					}
				}
				else
				{
					elt_depl.style.color = "red";
					elt_depl.style.fontWeight  = "normal";
				}
				maj_score();
				elt_depl.style.top = (h*H_TXT)+9 + "px";
			}
		}
		mouv = false;
	}
	else
	{ //décollage
		mouv = true;
		elt_depl = this;
		if (elt_depl.style.color=="green")
		{
			score--;
			maj_score();
			var h = elt_depl.style.top.substr(0, elt_depl.style.top.length-2);
			h = Math.floor(h/H_TXT);
			if (h<0)
			{
				h=0;
			}
			tab_occup[h] = false;
		}
		if (elt_depl.style.color=="red")
		{
			var h = elt_depl.style.top.substr(0, elt_depl.style.top.length-2);
			h = Math.floor(h/H_TXT);
			if (h<0)
			{
				h=0;
			}
			tab_occup[h] = false;		
		}
		document.addEventListener("mousemove", bouge, false);
	}
 }

//////////////////////////
 function start()
 {
	if (window.location.search.toLowerCase()=="?c")
	//encodage du tableau pour obfuscation basique
	{
		for (var i=0; i<tab_ministres.length; i++)
		{
			var row = "\"" + btoa(tab_ministres[i]) + "\",";
			console.log(row);
		}
		return;
	}

    elt("vernum").innerHTML = VERNUM;
	elt("version").title = VERDES;
	maj_score();
	
	for (i=0; i<nb_min; i++)
	{
		tab_idx[i] = i;
		tab_occup[i] = false;
	}

	//algo. de Fisher-Yates-Knuth
	//pour mélanger les ministères (tableau d'index)
    var j, k, tmp;
    for (j=tab_idx.length-1; j>0; j--)
	{
        k = Math.floor(Math.random()*(j+1));
        tmp = tab_idx[j];
        tab_idx[j] = tab_idx[k];
        tab_idx[k] = tmp;
    }

	//construction/affichage des deux listes
	for (i=0; i<nb_min; i++)
	{
		var myspan = document.createElement('span');
		myspan.className = "nom";
		myspan.style = "top:" + H_TXT*i + "px;";
		myspan.addEventListener("mousedown", unclic, false);
		myspan.innerHTML = atob(tab_ministres[i*2]);
		myspan.num = i;
		elt('main').appendChild(myspan);
		
		myspan = document.createElement('span');
		myspan.className = "ministere";
		myspan.style = "left:400px; top:" + H_TXT*i + "px;";
		var coul = 128+rnd(128);
		var couleur = "rgb("+coul+","+coul+","+coul+")";
		myspan.style.backgroundColor=couleur;
		myspan.innerHTML = atob(tab_ministres[tab_idx[i]*2+1]);
		elt('main').appendChild(myspan);
		
		//cadres
		myspan = document.createElement('span');
		myspan.className = "case";
		myspan.style = "height:" + H_TXT + "px; top:" + H_TXT*i + "px;";
		elt('main').appendChild(myspan);
	}
 }
 
function hide_help()
{
	elt("helpbox").style.display = "none";
}

function fin()
{
	elt("essfin").innerHTML = essais + " essais";
	elt("finbox").style.display = "";
}
</script>
</HEAD>
<body onload="start()" style="user-select:none">
<div id="helpbox" class="box">
	<div id="help" class="modal">
	L'objectif du jeu est de faire correspondre, en un minimum d'essais, chaque nom de ministre avec celui de son ministère.<BR>
	<B>Cliquer</B> sur un nom de ministre pour commencer à le <B>déplacer</B> puis <B>cliquer</B> de nouveau pour le <B>déposer</B> en face d'un ministère.<BR>
	La liste des ministres est classée par ordre alphabétique, les ministères étant mélangés (et colorés) aléatoirement.<BR>
	Il est possible de reposer le nom d'un ministre dans la liste de départ.<BR>
	<BR>
	<center><button onclick="hide_help()">OK</button></center>
	</div>
</div>
<div id="scoreaff"><div id="scorebar"><span id="score"></span></div></div>
<div id="essais"></div>
<div id="main"></div>
<div id="version"><A HREF="https://github.com/gjandot/GouvTrouv" TARGET="_blank">Version <span id="vernum">0.000</span></A></div>
<div id="finbox" class="box" style="display:none">
	<div id="fin" class="modal">
		Bravo !<BR>
		<div id="essfin"></div>
	</div>
</div>
</body>
</html>